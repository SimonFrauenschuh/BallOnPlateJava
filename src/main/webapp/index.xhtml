<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Copyright (C) 2021 Simon Frauenschuh - All Rights Reserved
 * You may use and / or modify this code in
 * terms of private use.
 * Any caused damage or misbehaviour of any components are
 * under the responsibility of the user and and the editor
 * cannot be prosecuted for it
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    template="/WEB-INF/templates/default.xhtml">
    
    <ui:define name="content">
		<img class="picture_logo" src="https://raw.githubusercontent.com/SimonFrauenschuh/BallOnPlateJava/67ea06b050bd746e42c756ceeac2fd0bb7741a9f/src/main/resources/Logo_Sisyphos2.png" alt="Logo Sisyphos 2.0">
        </img>
    	<div class="h1_title">
       		<h1>Sisyphos 2.0</h1>
            <p>Diploma Work of Simon Frauenschuh and Sebastian Haider</p>
        </div>
		<!-- Define Class that is called everytime, the site is reloaded / called -->
		<f:metadata>
    		<f:viewParam name="foo" value="#{bean.foo}" />
    		<f:event type="preRenderView" listener="#{databaseTouchpanelController.startup}" />
		</f:metadata>
		
		<div class="left">
        <h:form id="reg" style="width:100%">
        	<div class="box_webControl">
	        	<h2>Web Control</h2>
	            <div>
	            	<p>Maybe some extremely helpful information in the future</p>
	            </div>
	        	<h:panelGrid columns="3" columnClasses="titleCell">
	                <h:outputLabel for="xPosition" value="xPosition: " />
	                <h:inputText id="xPosition" value="#{newDatabaseModel.XEst}" />
	                <h:message for="xPosition" errorClass="invalid" />
	
	                <h:outputLabel for="yPosition" value="yPosition: " />
	                <h:inputText id="yPosition" value="#{newDatabaseModel.YEst}" />
	                <h:message for="yPosition" errorClass="invalid" />
	            </h:panelGrid>
	
	            <p>
	            <h:panelGrid columns="1">
	                    <h:commandButton id="register"
	                    action="#{databaseTouchpanelController.register}"
	                    value="Register" styleClass="register" class="button button_register">
	                    </h:commandButton>
	                <h:messages styleClass="messages"
	                    errorClass="invalid" infoClass="valid"
	                    warnClass="warning" globalOnly="true" />
	            </h:panelGrid>
	            </p>
	          </div>
        </h:form>
        
        <!-- Get the values for the table -->
        <script type="text/javascript">
			setInterval(function(){ 
				fetch('/Sisyphos/rest/entrys/last', {
					method: 'GET',
					headers: {
						'Accept': 'application/json',
					},
				})
				.then(response => response.text())
				.then(text => {		
					var data = JSON.parse(text);
					
					var id = data.id;
					var positionXReal = data.xreal;
					var positionYReal = data.yreal;
					var positionXEst = data.xest;
					var positionYEst = data.yest;
					
					document.getElementById('rId').innerHTML = id;
					document.getElementById('rPosXest').innerHTML = positionXEst;
					document.getElementById('rPosYest').innerHTML = positionYEst;
					document.getElementById('rPosXre').innerHTML = positionXReal;
					document.getElementById('rPosYre').innerHTML = positionYReal;

					}
				)
			 
			}, 500);
		</script>
        
        <div class="box_webView">
	        <h2>Web View</h2>

	    	<table id="TableWebView">
	    		<tr>
	    			<th>ID</th>
	    			<th>Position X Est</th>
	    			<th>Position Y Est</th>
	    			<th>Position X Real</th>
	    			<th>Position Y Real</th>
	    		</tr>
				<tr>
					<td><span id="rId"></span></td>
					<td><span id="rPosXest"></span></td>
					<td><span id="rPosYest"></span></td>
					<td><span id="rPosXre"></span></td>
					<td><span id="rPosYre"></span></td>
				</tr>
	    	</table>
	    	</div>
    	</div>
    </ui:define>
    
    
    <ui:define name="visualization">
        <div class="right">
	        <div class="box_visualization">
	    		<h2>Visualization</h2>		
			    	<a href="/Sisyphos/gamemode.html">
			    		<canvas id="visualization" style="border:2px solid #000000; background-color: white;" width="365" height="235">
				    		<script type="text/javascript">
				    			// Get the values for the visualization
					    		setInterval(function(){ 
									fetch('/Sisyphos/TouchpanelServlet', {
									    method: 'GET',
									    headers: {
									        'Accept': 'application/json',
									    },
									})
									.then(response => response.text())
									.then(text => {						
												var posX = text.slice(0, 3);
									    		var posY = text.slice(3);
									    		
									    		var c = document.getElementById("visualization");
												var ctx = c.getContext("2d");
												ctx.fillStyle = "black";
												ctx.beginPath();
												ctx.arc(posX,posY,15,0,2*Math.PI);
												ctx.fill();
											}
									) 
								}, 200);				
							</script>
						</canvas>
					</a>
			</div>
		<h4>Wir freuen uns über jede Unterstützung</h4>
		<form action="https://www.paypal.com/donate" method="post" target="_top">
			<input type="hidden" name="hosted_button_id" value="RKCJMAWVDXHRS" />
			<input type="image" src="https://www.paypalobjects.com/de_DE/AT/i/btn/btn_donateCC_LG.gif" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Spenden mit dem PayPal-Button" />
		</form>
		</div>
    </ui:define>
</ui:composition>
