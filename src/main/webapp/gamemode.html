<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Gamemode</title>
</head>
<body>
<h2>Gamemode</h2>
		
   	<canvas id="gamemode" width="400" height="300" style="border:2px solid #000000; background-color: whit;">
   		<!-- Getting the ball-values from the db and create the canvas-->
		<script type="text/javascript">
			
			// Copyright https://reqbin.com/code/javascript/rftjizcl/javascript-get-request-example
			fetch('/BallOnPlate/gamemode/GamemodeServlet', {
			    method: 'GET',
			    headers: {
			        'Accept': 'application/json',
			    },
			})
			.then(response => response.text())
			.then(text => {						
						var posX = text.slice(0, 3);
			    		var posY = text.slice(3);
			    		
			    		var c = document.getElementById("gamemode");
						var ctx = c.getContext("2d");
						ctx.fillStyle = "black";
						ctx.beginPath();
						ctx.arc(posX,posY,15,0,2*Math.PI);
						ctx.fill();
					}
			)
											
		</script>
	</canvas>
	
	<!-- Testbereich -->
<div id="canvas">
  <div id="middle"></div>
  <div id="ball"></div>
</div>

<style type="text/css">
#canvas {
     width: 200px;
     height: 200px;
     border: 5px solid #ddd;
     border-radius: 10px;
     -moz-border-radius: 10px;
   }
    #ball {
     background-color: green;
     position: relative;
     width: 20px;
     height: 20px;
     left: 90px;
     top: 90px;
     border-radius: 20px;
     -moz-border-radius: 20px;
     box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.4);
     -moz-box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.4);
     -webkit-box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.4);
     background-image: -moz-linear-gradient(top, rgba(255, 255, 255, .5), rgba(255, 255, 255, 0) 12px);
     background-image: -webkit-gradient(linear, 0 0, 0 12, from(rgba(255, 255, 255, .5)), to(rgba(255, 255, 255, 0)));
   }
</style>

	<!-- Testbereich ENDE -->
	
	
	<!-- Setting the mode to gamemode and send the gyroscope values of the phone-->
	<script type="text/javascript">
		
		// Copyright https://itnext.io/gyro-web-accessing-the-device-orientation-in-javascript-387da43eeb84
		function handleOrientation(event) {
	  		var gyroX = event.beta; //? event.beta : event.x * 90;
	  		var gyroY = event.gamma; //? event.gamma : event.y * 90;
	  		
	  		gyroX = parseInt(gyroX, 10);
	  		gyroY = parseInt(gyroY, 10);
	  		
	  		if(gyroX > 9){	//X consist of two digits (positive)
	  			if(gyroY > 9){	//Y consist of two digits (positive)
	  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: +" + gyroY + " }"
	  			} else if (gyroY >= 0){	//Y consist of one digit (positive)
	  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: +0" + gyroY + " }"
	  			} else if (gyroY < -9) { //Y consist of two digits (negative)
	  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: " + gyroY + " }"
	  			} else if (gyroY < 0) { //Y consist of one digit (negative)
	  				gyroY = gyroY * (-1);
	  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: -0" + gyroY + " }"
	  			}
	  		} else if(gyroX < -9) {	//X consist of two digits (negative)
	  			if(gyroY > 9){
	  				var stringValue = "{posXEst: " + gyroX + ", posYEst: +" + gyroY + " }"
	  			} else if (gyroY >= 0){
	  				var stringValue = "{posXEst: " + gyroX + ", posYEst: +0" + gyroY + " }"
	  			} else if (gyroY < -9) {
	  				var stringValue = "{posXEst: " + gyroX + ", posYEst: " + gyroY + " }"
	  			} else if (gyroY < 0) {
	  				gyroY = gyroY * (-1);
	  				var stringValue = "{posXEst: " + gyroX + ", posYEst: -0" + gyroY + " }"
	  			}
	  		} else if(gyroX >= 0){	//X consist of one digit (positive)
	  			if(gyroY > 9){
	  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: +" + gyroY + " }"
	  			} else if (gyroY >= 0){
	  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: +0" + gyroY + " }"
	  			} else if (gyroY < -9) {
	  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: " + gyroY + " }"
	  			} else if (gyroY < 0) {
	  				gyroY = gyroY * (-1);
	  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: -0" + gyroY + " }"
	  			}
	  		} else {	//X consist of one digit (negative)
  				gyroX = gyroX * (-1);
	  			if(gyroY > 9){
	  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: +" + gyroY + " }"
	  			} else if (gyroY >= 0){
	  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: +0" + gyroY + " }"
	  			} else if (gyroY < -9) {
	  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: " + gyroY + " }"
	  			} else if (gyroY < 0) {
	  				gyroY = gyroY * (-1);
	  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: -0" + gyroY + " }"
	  			}
	  		}
	  		
	  		window.console && console.info(stringValue);
	  	  
			
		  
			// Copyright https://reqbin.com/code/javascript/wzp2hxwh/javascript-post-request-example
			fetch('/BallOnPlate/gamemode/GamemodeServlet', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(stringValue)
			})
		}
	
		 if (typeof DeviceMotionEvent.requestPermission === 'function') {
			// Handle iOS 13+ devices.
		    DeviceMotionEvent.requestPermission().then((state) => {
		    	if (state === 'granted') {
		          window.addEventListener('devicemotion', handleOrientation, true);
		        } else {
		          console.error('Request to access the orientation was rejected');
		        }
			}).catch(console.error);
		  } else { 
		    // Handle regular non iOS 13+ devices.
		    window.addEventListener('deviceorientation', handleOrientation, true);
		  window.addEventListener("MozOrientation", handleOrientation, true);
		  }
			
		
	</script>
				
</body>
</html>