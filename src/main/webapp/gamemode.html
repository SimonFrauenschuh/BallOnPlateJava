<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Gamemode</title>
</head>
<body>
<h2>Gamemode</h2>
	
	<p id="result"></p>
	
	<!-- Get a new value every second and write it onto the screen -->
	<script type="text/javascript">
		setInterval(function(){ 
			fetch('/BallOnPlate/gamemode/GamemodeServlet', {
			    method: 'GET',
			    headers: {
			        'Accept': 'application/json',
			    },
			})
			.then(response => response.text())
			.then(text => {						
				document.getElementById("result").innerHTML = text.slice(0, 3);
				}
			) 
		}, 1000);										
	</script>
	
	<!-- Setting the mode to gamemode and send the gyroscope values of the phone-->
	<script type="text/javascript">
	
		var gyroXOld = 0;
		var gyroYOld = 0;
	
		// Copyright https://itnext.io/gyro-web-accessing-the-device-orientation-in-javascript-387da43eeb84
		function handleOrientation(event) {
	  		var gyroX = event.gamma;
	  		var gyroY = event.beta;
	  		
	  		gyroX = parseInt(gyroX, 10);
	  		gyroY = parseInt(gyroY, 10);
	  		
	  		if((gyroX < gyroXOld - 1) || (gyroX > gyroXOld + 1) || (gyroY < gyroYOld - 1) || (gyroY > gyroYOld + 1)) {	// Don't send values that are the same as before
	  			gyroXOld = gyroX;
		  		gyroYOld = gyroY;
	  			if(gyroX > 9){	//X consist of two digits (positive)
		  			if(gyroY > 9){	//Y consist of two digits (positive)
		  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: +" + gyroY + " }"
		  			} else if (gyroY >= 0){	//Y consist of one digit (positive)
		  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: +0" + gyroY + " }"
		  			} else if (gyroY < -9) { //Y consist of two digits (negative)
		  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: " + gyroY + " }"
		  			} else if (gyroY < 0) { //Y consist of one digit (negative)
		  				gyroY = gyroY * (-1);
		  				var stringValue = "{posXEst: +" + gyroX + ", posYEst: -0" + gyroY + " }"
		  			}
		  		} else if(gyroX < -9) {	//X consist of two digits (negative)
		  			if(gyroY > 9){
		  				var stringValue = "{posXEst: " + gyroX + ", posYEst: +" + gyroY + " }"
		  			} else if (gyroY >= 0){
		  				var stringValue = "{posXEst: " + gyroX + ", posYEst: +0" + gyroY + " }"
		  			} else if (gyroY < -9) {
		  				var stringValue = "{posXEst: " + gyroX + ", posYEst: " + gyroY + " }"
		  			} else if (gyroY < 0) {
		  				gyroY = gyroY * (-1);
		  				var stringValue = "{posXEst: " + gyroX + ", posYEst: -0" + gyroY + " }"
		  			}
		  		} else if(gyroX >= 0){	//X consist of one digit (positive)
		  			if(gyroY > 9){
		  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: +" + gyroY + " }"
		  			} else if (gyroY >= 0){
		  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: +0" + gyroY + " }"
		  			} else if (gyroY < -9) {
		  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: " + gyroY + " }"
		  			} else if (gyroY < 0) {
		  				gyroY = gyroY * (-1);
		  				var stringValue = "{posXEst: +0" + gyroX + ", posYEst: -0" + gyroY + " }"
		  			}
		  		} else {	//X consist of one digit (negative)
	  				gyroX = gyroX * (-1);
		  			if(gyroY > 9){
		  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: +" + gyroY + " }"
		  			} else if (gyroY >= 0){
		  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: +0" + gyroY + " }"
		  			} else if (gyroY < -9) {
		  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: " + gyroY + " }"
		  			} else if (gyroY < 0) {
		  				gyroY = gyroY * (-1);
		  				var stringValue = "{posXEst: -0" + gyroX + ", posYEst: -0" + gyroY + " }"
		  			}
		  		}
	  		    
				fetch('/BallOnPlate/gamemode/GamemodeServlet', {
					method: 'POST',
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(stringValue)
				})
	  		}
		}
		
		// Access device orientation on non-iOS
		window.addEventListener('deviceorientation', handleOrientation, true);
		
	</script>
	
	<!-- Needed for iOS, only way to access the gyroscope -->
	<button onclick='requestOrientationPermission();'>Start iOS</button>
	
	<script type="text/javascript">
    function requestOrientationPermission(){
        DeviceOrientationEvent.requestPermission()
        .catch(console.error)
    }
	</script>
				
</body>
</html>