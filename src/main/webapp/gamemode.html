<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Gamemode</title>
</head>
<body>
<h2>Gamemode</h2>
		
   	<canvas id="gamemode" width="400" height="300" style="border:2px solid #000000; background-color: whit;">
   		<!-- Getting the ball-values from the db and create the canvas-->
		<script type="text/javascript">
			
			// Copyright https://reqbin.com/code/javascript/rftjizcl/javascript-get-request-example
			fetch('http://localhost:8080/BallOnPlate/gamemode/GamemodeServlet', {
			    method: 'GET',
			    headers: {
			        'Accept': 'application/json',
			    },
			})
			.then(response => response.text())
			.then(text => {						
						var posX = text.slice(0, 3);
			    		var posY = text.slice(3);
			    		
			    		var c = document.getElementById("gamemode");
						var ctx = c.getContext("2d");
						ctx.fillStyle = "black";
						ctx.beginPath();
						ctx.arc(posX,posY,15,0,2*Math.PI);
						ctx.fill();
					}
			)
											
		</script>
	</canvas>
	
	<!-- Setting the mode to gamemode and send the gyroscope values of the phone-->
	<script type="text/javascript">
		
		// Copyright https://itnext.io/gyro-web-accessing-the-device-orientation-in-javascript-387da43eeb84
		function handleOrientation(event) {
	  	  const gyroX = event.beta;
	  	  const gyroY = event.gamma;
	  	  
		  const stringValue = '{ posXEst: x, posYEst: y }';
		  stringValue.replace('x', gyroX) && stringValue.replace('y', gyroY);
		  
			// Copyright https://reqbin.com/code/javascript/wzp2hxwh/javascript-post-request-example
				fetch('http://172.16.167.110:8080/BallOnPlate/gamemode/GamemodeServlet', {
					method: 'POST',
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
						},
					body: JSON.stringify(stringValue)
				})
		}
	
			  if (typeof DeviceMotionEvent.requestPermission === 'function') {
			    // Handle iOS 13+ devices.
			    DeviceMotionEvent.requestPermission()
			      .then((state) => {
			        if (state === 'granted') {
			          window.addEventListener('devicemotion', handleOrientation);
			        } else {
			          console.error('Request to access the orientation was rejected');
			        }
			      })
			      .catch(console.error);
			  } else {
			    // Handle regular non iOS 13+ devices.
			    window.addEventListener('devicemotion', handleOrientation);
			  }
			
		
	</script>
				
</body>
</html>